!function(t){var e={containerid:null,datatype:"table",dataset:null,columns:null,returnUri:!1,worksheetName:"My Worksheet",encoding:"utf-8"},n=e;t.fn.battatech_excelexport=function(a){function i(){var t=n.datatype.toLowerCase();switch(r(t),t){case"table":d=h(s());break;case"json":d=h(o());break;case"xml":d=h(o());break;case"jqgrid":d=h(o())}return n.returnUri?d:void window.open(d)}function r(e){switch(e){case"table":break;case"json":u=n.dataset;break;case"xml":t(n.dataset).find("row").each(function(){var e={};null!=this.attributes&&this.attributes.length>0&&(t(this.attributes).each(function(){e[this.name]=this.value}),u.push(e))});break;case"jqgrid":t(n.dataset).find("rows > row").each(function(){var e={};null!=this.children&&this.children.length>0&&(t(this.children).each(function(){e[this.tagName]=t(this).text()}),u.push(e))})}}function s(){var e=t("<div>").append(t("#"+n.containerid).clone()).html();return e}function o(){var e="<table>";return e+="<thead><tr>",t(n.columns).each(function(){1!=this.ishidden&&(e+="<th",null!=this.width&&(e+=" style='width: "+this.width+"'"),e+=">",e+=this.headertext,e+="</th>")}),e+="</tr></thead>",e+="<tbody>",t(u).each(function(a,i){e+="<tr>",t(n.columns).each(function(){i.hasOwnProperty(this.datafield)&&1!=this.ishidden&&(e+="<td",null!=this.width&&(e+=" style='width: "+this.width+"'"),e+=">",e+=i[this.datafield],e+="</td>")}),e+="</tr>"}),e+="</tbody>",e+="</table>"}function h(t){var a="<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:x='urn:schemas-microsoft-com:office:excel' xmlns='http://www.w3.org/TR/REC-html40'>";a+="<head>",a+='<meta http-equiv="Content-type" content="text/html;charset='+e.encoding+'" />',a+="<!--[if gte mso 9]>",a+="<xml>",a+="<x:ExcelWorkbook>",a+="<x:ExcelWorksheets>",a+="<x:ExcelWorksheet>",a+="<x:Name>",a+="{worksheet}",a+="</x:Name>",a+="<x:WorksheetOptions>",a+="<x:DisplayGridlines/>",a+="</x:WorksheetOptions>",a+="</x:ExcelWorksheet>",a+="</x:ExcelWorksheets>",a+="</x:ExcelWorkbook>",a+="</xml>",a+="<![endif]-->",a+="</head>",a+="<body>",a+=t.replace(/"/g,"'"),a+="</body>",a+="</html>";var i="data:application/vnd.ms-excel;base64,",r={worksheet:n.worksheetName,table:t};return i+c(l(a,r))}function c(t){return window.btoa(unescape(encodeURIComponent(t)))}function l(t,e){return t.replace(/{(\w+)}/g,function(t,n){return e[n]})}n=t.extend({},e,a);var d,u=[];return i()}}(jQuery);